<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="API documentation for the Rust `BlockSupport` trait in crate `cplfs_api`."><meta name="keywords" content="rust, rustlang, rust-lang, BlockSupport"><title>cplfs_api::fs::BlockSupport - Rust</title><link rel="stylesheet" type="text/css" href="../../normalize.css"><link rel="stylesheet" type="text/css" href="../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../../light.css"  id="themeStyle"><link rel="stylesheet" type="text/css" href="../../dark.css" disabled ><link rel="stylesheet" type="text/css" href="../../ayu.css" disabled ><script src="../../storage.js"></script><noscript><link rel="stylesheet" href="../../noscript.css"></noscript><link rel="shortcut icon" href="../../favicon.ico"><style type="text/css">#crate-search{background-image:url("../../down-arrow.svg");}</style></head><body class="rustdoc trait"><!--[if lte IE 8]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu">&#9776;</div><a href='../../cplfs_api/index.html'><div class='logo-container rust-logo'><img src='../../rust-logo.png' alt='logo'></div></a><p class='location'>Trait BlockSupport</p><div class="sidebar-elems"><div class="block items"><a class="sidebar-title" href="#required-methods">Required Methods</a><div class="sidebar-links"><a href="#tymethod.b_alloc">b_alloc</a><a href="#tymethod.b_free">b_free</a><a href="#tymethod.b_get">b_get</a><a href="#tymethod.b_put">b_put</a><a href="#tymethod.b_zero">b_zero</a><a href="#tymethod.sup_get">sup_get</a><a href="#tymethod.sup_put">sup_put</a></div><a class="sidebar-title" href="#implementors">Implementors</a></div><p class='location'><a href='../index.html'>cplfs_api</a>::<wbr><a href='index.html'>fs</a></p><script>window.sidebarCurrent = {name: 'BlockSupport', ty: 'trait', relpath: ''};</script><script defer src="sidebar-items.js"></script></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!"><img src="../../brush.svg" width="18" alt="Pick another theme!"></button><div id="theme-choices"></div></div><script src="../../theme.js"></script><nav class="sub"><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" disabled autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><span class="help-button">?</span>
                <a id="settings-menu" href="../../settings.html"><img src="../../wheel.svg" width="18" alt="Change settings"></a></div></form></nav><section id="main" class="content"><h1 class='fqn'><span class='out-of-band'><span id='render-detail'><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class='inner'>&#x2212;</span>]</a></span><a class='srclink' href='../../src/cplfs_api/fs.rs.html#95-136' title='goto source code'>[src]</a></span><span class='in-band'>Trait <a href='../index.html'>cplfs_api</a>::<wbr><a href='index.html'>fs</a>::<wbr><a class="trait" href=''>BlockSupport</a></span></h1><div class="docblock type-decl hidden-by-usual-hider"><pre class='rust trait'>pub trait BlockSupport: <a class="trait" href="../../cplfs_api/fs/trait.FileSysSupport.html" title="trait cplfs_api::fs::FileSysSupport">FileSysSupport</a> {
    fn <a href='#tymethod.b_get' class='fnname'>b_get</a>(&amp;self, i: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.u64.html">u64</a>) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="struct" href="../../cplfs_api/types/struct.Block.html" title="struct cplfs_api::types::Block">Block</a>, Self::<a class="type" href="../../cplfs_api/fs/trait.FileSysSupport.html#associatedtype.Error" title="type cplfs_api::fs::FileSysSupport::Error">Error</a>&gt;;
<div class='item-spacer'></div>    fn <a href='#tymethod.b_put' class='fnname'>b_put</a>(&amp;mut self, b: &amp;<a class="struct" href="../../cplfs_api/types/struct.Block.html" title="struct cplfs_api::types::Block">Block</a>) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>, Self::<a class="type" href="../../cplfs_api/fs/trait.FileSysSupport.html#associatedtype.Error" title="type cplfs_api::fs::FileSysSupport::Error">Error</a>&gt;;
<div class='item-spacer'></div>    fn <a href='#tymethod.b_free' class='fnname'>b_free</a>(&amp;mut self, i: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.u64.html">u64</a>) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>, Self::<a class="type" href="../../cplfs_api/fs/trait.FileSysSupport.html#associatedtype.Error" title="type cplfs_api::fs::FileSysSupport::Error">Error</a>&gt;;
<div class='item-spacer'></div>    fn <a href='#tymethod.b_zero' class='fnname'>b_zero</a>(&amp;mut self, i: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.u64.html">u64</a>) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>, Self::<a class="type" href="../../cplfs_api/fs/trait.FileSysSupport.html#associatedtype.Error" title="type cplfs_api::fs::FileSysSupport::Error">Error</a>&gt;;
<div class='item-spacer'></div>    fn <a href='#tymethod.b_alloc' class='fnname'>b_alloc</a>(&amp;mut self) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.u64.html">u64</a>, Self::<a class="type" href="../../cplfs_api/fs/trait.FileSysSupport.html#associatedtype.Error" title="type cplfs_api::fs::FileSysSupport::Error">Error</a>&gt;;
<div class='item-spacer'></div>    fn <a href='#tymethod.sup_get' class='fnname'>sup_get</a>(&amp;self) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="struct" href="../../cplfs_api/types/struct.SuperBlock.html" title="struct cplfs_api::types::SuperBlock">SuperBlock</a>, Self::<a class="type" href="../../cplfs_api/fs/trait.FileSysSupport.html#associatedtype.Error" title="type cplfs_api::fs::FileSysSupport::Error">Error</a>&gt;;
<div class='item-spacer'></div>    fn <a href='#tymethod.sup_put' class='fnname'>sup_put</a>(&amp;mut self, sup: &amp;<a class="struct" href="../../cplfs_api/types/struct.SuperBlock.html" title="struct cplfs_api::types::SuperBlock">SuperBlock</a>) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>, Self::<a class="type" href="../../cplfs_api/fs/trait.FileSysSupport.html#associatedtype.Error" title="type cplfs_api::fs::FileSysSupport::Error">Error</a>&gt;;
}</pre></div><div class='docblock'><p>This trait adds block-level operations to your file system
Do not forget to make sure that <code>mkfs</code> now correctly initializes all inodes, as described above.</p>
</div>
            <h2 id='required-methods' class='small-section-header'>Required methods<a href='#required-methods' class='anchor'></a></h2><div class='methods'><h3 id='tymethod.b_get' class='method'><code>fn <a href='#tymethod.b_get' class='fnname'>b_get</a>(&amp;self, i: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.u64.html">u64</a>) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="struct" href="../../cplfs_api/types/struct.Block.html" title="struct cplfs_api::types::Block">Block</a>, Self::<a class="type" href="../../cplfs_api/fs/trait.FileSysSupport.html#associatedtype.Error" title="type cplfs_api::fs::FileSysSupport::Error">Error</a>&gt;</code></h3><div class='docblock'><p>Read the <em>n</em>th block <em>of the entire disk</em> and return it<br />
The implementation of this method should be trivial</p>
</div><h3 id='tymethod.b_put' class='method'><code>fn <a href='#tymethod.b_put' class='fnname'>b_put</a>(&amp;mut self, b: &amp;<a class="struct" href="../../cplfs_api/types/struct.Block.html" title="struct cplfs_api::types::Block">Block</a>) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>, Self::<a class="type" href="../../cplfs_api/fs/trait.FileSysSupport.html#associatedtype.Error" title="type cplfs_api::fs::FileSysSupport::Error">Error</a>&gt;</code></h3><div class='docblock'><p>Write the <em>n</em>th block <em>of the entire disk</em> and return it<br />
The implementation of this method should be trivial</p>
</div><h3 id='tymethod.b_free' class='method'><code>fn <a href='#tymethod.b_free' class='fnname'>b_free</a>(&amp;mut self, i: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.u64.html">u64</a>) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>, Self::<a class="type" href="../../cplfs_api/fs/trait.FileSysSupport.html#associatedtype.Error" title="type cplfs_api::fs::FileSysSupport::Error">Error</a>&gt;</code></h3><div class='docblock'><p>Free the <em>i</em>th block <em>in the block data region</em>, by setting the <em>i</em>th bit in the free bit map region to zero.
To disambiguate the binary representation, we define the order of the bits within each byte you read from right to left, i.e. the byte '0b0000_0001' has its <strong>first</strong> bit set to one, i.e. has its bit with index 0 set to 1.
Be careful not to change any bits for other blocks around the <em>i</em>th block by overwriting an entire byte in the free bit map region!
Consider writing some auxiliary methods for more fine-grained access to <code>Block</code>s, by wrapping the provided block type in a different type.</p>
<p>Remember that you <em>cannot</em> access memory on a per-bit basis!
The bitwise operators <code>&amp;</code> (bitwise AND), <code>|</code> (bitwise OR), <code>^</code> (bitwise XOR) exist; use those, together with the bit-shift operators <code>&gt;&gt;</code> and <code>&lt;&lt;</code>, to change the correct bit (or use an external, stable crate).</p>
<p>If the <em>i</em>th block is already a free block, the state of memory should not change, and this method should return an error
Also errors if the index <em>i</em> is out of bounds, i.e. if it is higher than the number of data blocks</p>
</div><h3 id='tymethod.b_zero' class='method'><code>fn <a href='#tymethod.b_zero' class='fnname'>b_zero</a>(&amp;mut self, i: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.u64.html">u64</a>) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>, Self::<a class="type" href="../../cplfs_api/fs/trait.FileSysSupport.html#associatedtype.Error" title="type cplfs_api::fs::FileSysSupport::Error">Error</a>&gt;</code></h3><div class='docblock'><p>Zeroes the <em>i</em>th block <em>in the block data region</em> in memory (without freeing it)<br />
Errors if the index <em>i</em> is out of bounds, i.e. if it is higher than the number of data blocks</p>
</div><h3 id='tymethod.b_alloc' class='method'><code>fn <a href='#tymethod.b_alloc' class='fnname'>b_alloc</a>(&amp;mut self) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.u64.html">u64</a>, Self::<a class="type" href="../../cplfs_api/fs/trait.FileSysSupport.html#associatedtype.Error" title="type cplfs_api::fs::FileSysSupport::Error">Error</a>&gt;</code></h3><div class='docblock'><p>Allocate the first free block, starting from the beginning, in the data block region, thereby setting its bit in the bitmap region to one and the entire contents of the block to zero.
Again, you will need bit-wise operators to implement this function.
Obviously, only blocks that have not been allocated yet, i.e. do not have their bit set, can still be allocated.
Returns the index (<em>within the data region</em>) of the newly allocated block.
Make sure to load each <em>bitmap</em> block only once in your implementation.
Errors appropriately if no blocks are available.</p>
</div><h3 id='tymethod.sup_get' class='method'><code>fn <a href='#tymethod.sup_get' class='fnname'>sup_get</a>(&amp;self) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="struct" href="../../cplfs_api/types/struct.SuperBlock.html" title="struct cplfs_api::types::SuperBlock">SuperBlock</a>, Self::<a class="type" href="../../cplfs_api/fs/trait.FileSysSupport.html#associatedtype.Error" title="type cplfs_api::fs::FileSysSupport::Error">Error</a>&gt;</code></h3><div class='docblock'><p>Get the superblock describing the current file system</p>
</div><h3 id='tymethod.sup_put' class='method'><code>fn <a href='#tymethod.sup_put' class='fnname'>sup_put</a>(&amp;mut self, sup: &amp;<a class="struct" href="../../cplfs_api/types/struct.SuperBlock.html" title="struct cplfs_api::types::SuperBlock">SuperBlock</a>) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>, Self::<a class="type" href="../../cplfs_api/fs/trait.FileSysSupport.html#associatedtype.Error" title="type cplfs_api::fs::FileSysSupport::Error">Error</a>&gt;</code></h3><div class='docblock'><p>Write the superblock to this file system's underlying device (and cache it, depending on how you implement your file system)
Note that in general, when you write to a block, you read the block first and then overwrite the parts you need to change before writing it back, to make sure all other parts of the block remain unchanged.
In this case, that is not strictly necessary, as the superblock is the only useful thing that is stored on the first disk block.
However, in case other data were to be stored past the superblock struct in the future, do implement this function in this conservative way.</p>
</div></div><span class='loading-content'>Loading content...</span>
            <h2 id='implementors' class='small-section-header'>Implementors<a href='#implementors' class='anchor'></a></h2><div class='item-list' id='implementors-list'></div><span class='loading-content'>Loading content...</span><script type="text/javascript" src="../../implementors/cplfs_api/fs/trait.BlockSupport.js" async></script></section><section id="search" class="content hidden"></section><section class="footer"></section><script>window.rootPath = "../../";window.currentCrate = "cplfs_api";</script><script src="../../main.js"></script><script defer src="../../search-index.js"></script></body></html>