<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="API documentation for the Rust `PathSupport` trait in crate `cplfs_api`."><meta name="keywords" content="rust, rustlang, rust-lang, PathSupport"><title>cplfs_api::fs::PathSupport - Rust</title><link rel="stylesheet" type="text/css" href="../../normalize.css"><link rel="stylesheet" type="text/css" href="../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../../light.css"  id="themeStyle"><link rel="stylesheet" type="text/css" href="../../dark.css" disabled ><link rel="stylesheet" type="text/css" href="../../ayu.css" disabled ><script src="../../storage.js"></script><noscript><link rel="stylesheet" href="../../noscript.css"></noscript><link rel="shortcut icon" href="../../favicon.ico"><style type="text/css">#crate-search{background-image:url("../../down-arrow.svg");}</style></head><body class="rustdoc trait"><!--[if lte IE 8]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu">&#9776;</div><a href='../../cplfs_api/index.html'><div class='logo-container rust-logo'><img src='../../rust-logo.png' alt='logo'></div></a><p class='location'>Trait PathSupport</p><div class="sidebar-elems"><div class="block items"><a class="sidebar-title" href="#required-methods">Required Methods</a><div class="sidebar-links"><a href="#tymethod.get_cwd">get_cwd</a><a href="#tymethod.mkdir">mkdir</a><a href="#tymethod.resolve_path">resolve_path</a><a href="#tymethod.set_cwd">set_cwd</a><a href="#tymethod.unlink">unlink</a><a href="#tymethod.valid_path">valid_path</a></div><a class="sidebar-title" href="#implementors">Implementors</a></div><p class='location'><a href='../index.html'>cplfs_api</a>::<wbr><a href='index.html'>fs</a></p><script>window.sidebarCurrent = {name: 'PathSupport', ty: 'trait', relpath: ''};</script><script defer src="sidebar-items.js"></script></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!"><img src="../../brush.svg" width="18" alt="Pick another theme!"></button><div id="theme-choices"></div></div><script src="../../theme.js"></script><nav class="sub"><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" disabled autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><span class="help-button">?</span>
                <a id="settings-menu" href="../../settings.html"><img src="../../wheel.svg" width="18" alt="Change settings"></a></div></form></nav><section id="main" class="content"><h1 class='fqn'><span class='out-of-band'><span id='render-detail'><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class='inner'>&#x2212;</span>]</a></span><a class='srclink' href='../../src/cplfs_api/fs.rs.html#289-352' title='goto source code'>[src]</a></span><span class='in-band'>Trait <a href='../index.html'>cplfs_api</a>::<wbr><a href='index.html'>fs</a>::<wbr><a class="trait" href=''>PathSupport</a></span></h1><div class="docblock type-decl hidden-by-usual-hider"><pre class='rust trait'>pub trait PathSupport: <a class="trait" href="../../cplfs_api/fs/trait.DirectorySupport.html" title="trait cplfs_api::fs::DirectorySupport">DirectorySupport</a> {
    fn <a href='#tymethod.valid_path' class='fnname'>valid_path</a>(path: &amp;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.str.html">str</a>) -&gt; <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.bool.html">bool</a>;
<div class='item-spacer'></div>    fn <a href='#tymethod.get_cwd' class='fnname'>get_cwd</a>(&amp;self) -&gt; <a class="struct" href="https://doc.rust-lang.org/nightly/alloc/string/struct.String.html" title="struct alloc::string::String">String</a>;
<div class='item-spacer'></div>    fn <a href='#tymethod.set_cwd' class='fnname'>set_cwd</a>(&amp;mut self, path: &amp;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.str.html">str</a>) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/option/enum.Option.html" title="enum core::option::Option">Option</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>&gt;;
<div class='item-spacer'></div>    fn <a href='#tymethod.resolve_path' class='fnname'>resolve_path</a>(&amp;self, path: &amp;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.str.html">str</a>) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;Self::<a class="type" href="../../cplfs_api/fs/trait.InodeSupport.html#associatedtype.Inode" title="type cplfs_api::fs::InodeSupport::Inode">Inode</a>, Self::<a class="type" href="../../cplfs_api/fs/trait.FileSysSupport.html#associatedtype.Error" title="type cplfs_api::fs::FileSysSupport::Error">Error</a>&gt;;
<div class='item-spacer'></div>    fn <a href='#tymethod.mkdir' class='fnname'>mkdir</a>(&amp;mut self, path: &amp;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.str.html">str</a>) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;Self::<a class="type" href="../../cplfs_api/fs/trait.InodeSupport.html#associatedtype.Inode" title="type cplfs_api::fs::InodeSupport::Inode">Inode</a>, Self::<a class="type" href="../../cplfs_api/fs/trait.FileSysSupport.html#associatedtype.Error" title="type cplfs_api::fs::FileSysSupport::Error">Error</a>&gt;;
<div class='item-spacer'></div>    fn <a href='#tymethod.unlink' class='fnname'>unlink</a>(&amp;mut self, path: &amp;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.str.html">str</a>) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>, Self::<a class="type" href="../../cplfs_api/fs/trait.FileSysSupport.html#associatedtype.Error" title="type cplfs_api::fs::FileSysSupport::Error">Error</a>&gt;;
}</pre></div><div class='docblock'><p>Enhance the previous directory support with a notion of file paths (both absolute and relative), enabling the following:</p>
<ul>
<li>Allows looking up inodes along file paths, to allow for easier navigation.</li>
<li>Allows creating and unlinking (i.e. removing) directories at a given path location. The previously implemented <code>i_alloc</code> and <code>i_free</code> suffice for regular files, but can result in inconsistencies for directories.</li>
<li>Keeps track of the current working directory in your file system (pick an appropriate type to do this! **WARNING: give this some thought **). Usually, each process has its own current working directory, but since we only model a single process, we just store the current working directory in the file system.</li>
</ul>
<p>Do not forget to adapt the call to <code>mkfs</code>, so that the root directory is no longer empty, but like all other directories, gets initialized with &quot;.&quot; and &quot;..&quot; as its first two entries. The root directory is a special case, however, in the sense that &quot;..&quot; also points back to the root directory itself, since it has no parent.
Make sure the <code>nlink</code> field of the root directory is equal to 1 still, after the initialization phase.
Additionally, both the <code>mkfs</code> and <code>mountfs</code> calls initialize the current working directory to the root directory.</p>
<p><strong>IMPORTANT</strong>
for this assignment;</p>
<ul>
<li>We assume that none of the directories involved in the cwd's path will be deleted while we are in this directory. We do not check this at any point, nor do we lock any of those files or increase their <code>nlink</code>; we just assume that it will not happen. Additionally, we do not check that the cwd actually also exists in the file system; this is the responsibility of our clients</li>
<li>In general, it is <strong>not</strong> necessarily the case the parent of a directory is the previous directory in the path!
For example, starting from <code>/test</code> then following the path <code>../alternative</code> by reading the file system, does not necessarily have us end up in <code>/alternative</code>. The reason is that the parent of <code>test</code> might be some different directory entirely, because the <code>dirlink</code> method below allows us to re-register inodes in different directories.
<strong>However</strong>, you can assume that the parent of the cwd <strong>is</strong> the previous directory in the path when appending a relative path in the <code>set_cwd</code> method. This is also how terminals usually operate when e.g. following symbolic links and then running <code>cd ..</code>, in order not to confuse users.
That being said, any paths provided to other methods than <code>set_cwd</code> <strong>should go through the file system</strong>, i.e. read &quot;..&quot; at each point to figure out what the actual parent inode is.
If this explanation is unclear to you, consult the tests provided with the assignment</li>
</ul>
</div>
            <h2 id='required-methods' class='small-section-header'>Required methods<a href='#required-methods' class='anchor'></a></h2><div class='methods'><h3 id='tymethod.valid_path' class='method'><code>fn <a href='#tymethod.valid_path' class='fnname'>valid_path</a>(path: &amp;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.str.html">str</a>) -&gt; <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.bool.html">bool</a></code></h3><div class='docblock'><p>Returns true iff the given string represents a valid path
We support two different path formats:</p>
<ul>
<li><em>absolute paths</em> start with the character &quot;/&quot; and specify a path starting from the root node</li>
<li><em>relative paths</em> start with &quot;.&quot; or &quot;..&quot; and denote respectively a path starting from the current working directory, and a path starting from the parent of the current working directory</li>
</ul>
<p>A path is valid iff:</p>
<ul>
<li>It is not empty</li>
<li>It is either absolute or relative in form</li>
<li>It consists of a &quot;/&quot;-separated sequence of <em>names</em></li>
<li>It does not end in a &quot;/&quot; (the only exception being the path &quot;/&quot; itself)</li>
<li>Each one of these names is a <em>valid</em> directory entry name (see the <a href="../fs/trait.DirectorySupport.html"><code>DirectorySupport</code></a> trait)</li>
<li>Instead of an alphanumeric name, the special entries &quot;.&quot; and &quot;..&quot; can also appear anywhere in the file path. Their meaning is then similar to their meaning they have at the start of a relative path; &quot;.&quot; specifies staying in the current directory, whereas &quot;..&quot; specifies moving up to the parent directory.</li>
</ul>
</div><h3 id='tymethod.get_cwd' class='method'><code>fn <a href='#tymethod.get_cwd' class='fnname'>get_cwd</a>(&amp;self) -&gt; <a class="struct" href="https://doc.rust-lang.org/nightly/alloc/string/struct.String.html" title="struct alloc::string::String">String</a></code></h3><div class='docblock'><p>Return the current working directory as a String path
The value you return here should be an absolute path with respect to the root path <code>/</code>, and should not contain the special names &quot;.&quot; or &quot;..&quot;</p>
</div><h3 id='tymethod.set_cwd' class='method'><code>fn <a href='#tymethod.set_cwd' class='fnname'>set_cwd</a>(&amp;mut self, path: &amp;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.str.html">str</a>) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/option/enum.Option.html" title="enum core::option::Option">Option</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>&gt;</code></h3><div class='docblock'><p>Set the current working directory to the path provided in the given String, if it is a valid path.
Returns none if the provided path was invalid.</p>
<p>If a relative path is provided, then that path is interpreted with respect to the current working directory.
As stated above, you should then <strong>not</strong> go through the file system to determine the new cwd, but rather have &quot;..&quot; cancel out the previous directory name, i.e. if the cwd is <code>test/child</code> then providing <code>../child_new</code> to this method, will unconditionally result in a new cwd of <code>test/child_new</code>, whereas it will not necessarily lead there when we read through the file system in the other methods.</p>
</div><h3 id='tymethod.resolve_path' class='method'><code>fn <a href='#tymethod.resolve_path' class='fnname'>resolve_path</a>(&amp;self, path: &amp;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.str.html">str</a>) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;Self::<a class="type" href="../../cplfs_api/fs/trait.InodeSupport.html#associatedtype.Inode" title="type cplfs_api::fs::InodeSupport::Inode">Inode</a>, Self::<a class="type" href="../../cplfs_api/fs/trait.FileSysSupport.html#associatedtype.Error" title="type cplfs_api::fs::FileSysSupport::Error">Error</a>&gt;</code></h3><div class='docblock'><p>Given a path name (possibly relative to the cwd), look up the inode corresponding to this path (the final inode could be either a file or a directory), and return it.
Works as follows:</p>
<ol>
<li>Figures out what inode the cwd corresponds to (skip this step if <code>path</code> is absolute)</li>
<li>Reads <code>path</code> through the file system</li>
</ol>
<p>Returns an error if</p>
<ul>
<li>the path is invalid</li>
<li>any directory, referenced in the path (or the cwd), does not exist</li>
<li>any of the intermediate names refers to a file that is not of directory type.</li>
</ul>
</div><h3 id='tymethod.mkdir' class='method'><code>fn <a href='#tymethod.mkdir' class='fnname'>mkdir</a>(&amp;mut self, path: &amp;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.str.html">str</a>) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;Self::<a class="type" href="../../cplfs_api/fs/trait.InodeSupport.html#associatedtype.Inode" title="type cplfs_api::fs::InodeSupport::Inode">Inode</a>, Self::<a class="type" href="../../cplfs_api/fs/trait.FileSysSupport.html#associatedtype.Error" title="type cplfs_api::fs::FileSysSupport::Error">Error</a>&gt;</code></h3><div class='docblock'><p>Create a new directory at the given path, where the last name of the path is the name for the new directory.
For example, the path <code>/test/dir</code> will create a directory named <code>dir</code> in the parent directory <code>test</code>.
Returns the newly created inode in case of success. Note that the newly created directory is already referenced once, i.e. its <code>nlink</code> field is not 0.</p>
<p>New directories are created with 2 default entries in them, i.e. &quot;.&quot; and &quot;..&quot; (in this order), that point to the current directory's inode and its parent's inode, respectively. This allows us to easily go back to the parent directory of the current directory, and to succinctly reference sibling files and folders in the same directory.
Note that the addition of &quot;..&quot; causes the <code>nlink</code> field of the parent directory to increase by 1.</p>
<p>Error</p>
<ul>
<li>if the path is not valid</li>
<li>if the path's prefix (i.e. the part of the path without the name of the directory that we are about to create) does not exist in the file system yet.</li>
<li>if the last part of the path is not a valid directory name (i.e. it cannot be &quot;.&quot; or &quot;..&quot;)</li>
</ul>
</div><h3 id='tymethod.unlink' class='method'><code>fn <a href='#tymethod.unlink' class='fnname'>unlink</a>(&amp;mut self, path: &amp;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.str.html">str</a>) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>, Self::<a class="type" href="../../cplfs_api/fs/trait.FileSysSupport.html#associatedtype.Error" title="type cplfs_api::fs::FileSysSupport::Error">Error</a>&gt;</code></h3><div class='docblock'><p>Remove the directory entry located at path <code>path</code>, i.e. set the <code>inum</code> of this entry to 0 and the name of the entry to all zeroes, i.e. to <code>&quot;0&quot;.repeat(*DIRNAME_SIZE)</code>
For example, the path <code>/test/dir</code> will (on success) delete the directory entry &quot;dir&quot; in the parent directory <code>test</code>.
In essence, the inverse of <code>mkdir</code>.</p>
<p>Decreases the <code>nlink</code> field of the deleted entry by 1 (unless we just deleted a cyclic reference to the parent), and frees the inode in case <code>nlink</code> decreases to 0. In the latter case, a reference to the inode also gets deleted (since &quot;..&quot; in the entry's inode disappears when it is freed)</p>
<p>Errors and does nothing else in the following cases:</p>
<ul>
<li>the path ends in &quot;.&quot; or &quot;..&quot;; these entries cannot be removed</li>
<li>the path is not valid</li>
<li>the path does not exist yet in the file system, which includes the next bullet;</li>
<li>the entry is not present in the directory</li>
<li>the entry we are about to delete is itself a directory and non-empty (apart from the 2 default entries) - note: you cannot judge emptiness just from the size of the file, as it might contain directory entries that were previously unlinked as well</li>
</ul>
</div></div><span class='loading-content'>Loading content...</span>
            <h2 id='implementors' class='small-section-header'>Implementors<a href='#implementors' class='anchor'></a></h2><div class='item-list' id='implementors-list'></div><span class='loading-content'>Loading content...</span><script type="text/javascript" src="../../implementors/cplfs_api/fs/trait.PathSupport.js" async></script></section><section id="search" class="content hidden"></section><section class="footer"></section><script>window.rootPath = "../../";window.currentCrate = "cplfs_api";</script><script src="../../main.js"></script><script defer src="../../search-index.js"></script></body></html>