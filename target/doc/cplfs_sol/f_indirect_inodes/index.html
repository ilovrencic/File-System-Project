<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="API documentation for the Rust `f_indirect_inodes` mod in crate `cplfs_sol`."><meta name="keywords" content="rust, rustlang, rust-lang, f_indirect_inodes"><title>cplfs_sol::f_indirect_inodes - Rust</title><link rel="stylesheet" type="text/css" href="../../normalize.css"><link rel="stylesheet" type="text/css" href="../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../../light.css"  id="themeStyle"><link rel="stylesheet" type="text/css" href="../../dark.css" disabled ><link rel="stylesheet" type="text/css" href="../../ayu.css" disabled ><script src="../../storage.js"></script><noscript><link rel="stylesheet" href="../../noscript.css"></noscript><link rel="shortcut icon" href="../../favicon.ico"><style type="text/css">#crate-search{background-image:url("../../down-arrow.svg");}</style></head><body class="rustdoc mod"><!--[if lte IE 8]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu">&#9776;</div><a href='../../cplfs_sol/index.html'><div class='logo-container rust-logo'><img src='../../rust-logo.png' alt='logo'></div></a><p class='location'>Module f_indirect_inodes</p><div class="sidebar-elems"><div class="block items"><ul><li><a href="#types">Type Definitions</a></li></ul></div><p class='location'><a href='../index.html'>cplfs_sol</a></p><script>window.sidebarCurrent = {name: 'f_indirect_inodes', ty: 'mod', relpath: '../'};</script><script defer src="../sidebar-items.js"></script></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!"><img src="../../brush.svg" width="18" alt="Pick another theme!"></button><div id="theme-choices"></div></div><script src="../../theme.js"></script><nav class="sub"><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" disabled autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><span class="help-button">?</span>
                <a id="settings-menu" href="../../settings.html"><img src="../../wheel.svg" width="18" alt="Change settings"></a></div></form></nav><section id="main" class="content"><h1 class='fqn'><span class='out-of-band'><span id='render-detail'><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class='inner'>&#x2212;</span>]</a></span><a class='srclink' href='../../src/cplfs_sol/f_indirect_inodes.rs.html#1-59' title='goto source code'>[src]</a></span><span class='in-band'>Module <a href='../index.html'>cplfs_sol</a>::<wbr><a class="mod" href=''>f_indirect_inodes</a></span></h1><div class='docblock'><p>File system with support for inodes that have indirect blocks too.
Reimplementation of the inodes from the base project.
This additional assignment requires completion of assignment e, so go and do that one first if you haven't yet.</p>
<p>Create a filesystem that has a notion of inodes and blocks, by implementing the <a href="../../cplfs_api/fs/trait.FileSysSupport.html"><code>FileSysSupport</code></a>, the <a href="../../cplfs_api/fs/trait.BlockSupport.html"><code>BlockSupport</code></a>, the <a href="../../cplfs_api/fs/trait.InodeSupport.html"><code>InodeSupport</code></a> and the <a href="../../cplfs_api/fs/trait.InodeRWSupport.html"><code>InodeRWSupport</code></a> traits together (again, all earlier traits are supertraits of the later ones).</p>
<p>However, this time, you <strong>cannot</strong> use the <code>DInode</code> type I provided, but rather, you have to define your own type,  have it derive all the traits you need (check the <code>#[derive(...)]</code> for <code>DInode</code> in the provided API code), wrap it in your own <code>Inode</code> type, and have your own <code>Inode</code> type implement the <code>InodeLike</code> trait, so that it is still compatible with the tests.
So far, we have only supported inodes that have at most a fixed, direct number of data blocks (i.e. <code>DIRECT_POINTERS</code> data blocks) associated to them.
Reimplement your solution for the base project, but now support inodes that have an extra field (let's call this field the <em>indirect block</em> field), that points to a single data block; the so-called <em>indirect block</em>.
As long as your inode requires <code>DIRECT_POINTERS</code> data blocks or fewer, all code behaves as before and the indirect block field is set to 0.
As soon as block number <code>DIRECT_POINTERS+1</code> has to be allocated, the indirect block gets allocated along with it, to store a sequence of block numbers.
The address of block <code>DIRECT_POINTERS+1</code> gets stored as the first address in the indirect block.
Later, when data block <code>DIRECT_POINTERS+2</code> has to be allocated, it gets stored in the second slot on the indirect block, and so on. In other words, given that inode numbers are of type <code>u64</code> and should in principle be represented by 8 bytes at runtime, this indirect block allows files to allocate another <code>block_size/8</code> blocks.</p>
<p>Some more specific pointers for the implementation:</p>
<ul>
<li>Try to come up with some helper functions that make it more convenient to work with indirect blocks</li>
<li>Think of the scenario's where an indirect block might get (de)allocated. See if you can wrap this allocation in one of these previously mentioned helper functions.</li>
<li>Since the <code>new</code> method in <code>InodeLike</code> is static and does not allow you to allocate new blocks, it should still not allow you to provide more than <code>DIRECT_POINTERS+1</code> blocks. The last block is then the block number of the indirect block. Similarly, the <code>get_block</code> method should simply return the number of the indirect block when queried for block <em>index</em> <code>DIRECT_POINTERS</code>, since there is no way for inodes to read from the device to figure out the actual block number.</li>
<li>Do not forget to deallocate the indirect block itself, when truncating or freeing an inode.</li>
</ul>
<p>It should be possible to swap out the inodes you use in your filesystem so far without making any of the tests for previous assignments fail.
You could do this (rather than copying all of your code and starting over) if you want some extra assurance that your implementation is still correct (or at least, still correct when not indexing inodes past the <code>DIRECT_POINTERS</code>th block)
At the end, write some tests that convincingly show that your implementation indeed supports indirect pointers.</p>
<p>Make sure this file does not contain any unaddressed <code>TODO</code>s anymore when you hand it in.</p>
<h1 id="status" class="section-header"><a href="#status">Status</a></h1>
<p><strong>TODO</strong>: Replace the question mark below with YES, NO, or PARTIAL to
indicate the status of this assignment. If you want to tell something
about this assignment to the grader, e.g., you have a bug you can't fix,
or you want to explain your approach, write it down after the comments
section. If you had no major issues and everything works, there is no need to write any comments.</p>
<p>COMPLETED: ?</p>
<p>COMMENTS:</p>
<p>...</p>
</div><h2 id='types' class='section-header'><a href="#types">Type Definitions</a></h2>
<table><tr class='module-item'><td><a class="type" href="type.FSName.html" title='cplfs_sol::f_indirect_inodes::FSName type'>FSName</a></td><td class='docblock-short'><p>You are free to choose the name for your file system. As we will use
automated tests when grading your assignment, indicate here the name of
your file system data type so we can just use <code>FSName</code> instead of
having to manually figure out the name.
<strong>TODO</strong>: replace the below type by the type of your file system</p>
</td></tr></table></section><section id="search" class="content hidden"></section><section class="footer"></section><script>window.rootPath = "../../";window.currentCrate = "cplfs_sol";</script><script src="../../main.js"></script><script defer src="../../search-index.js"></script></body></html>