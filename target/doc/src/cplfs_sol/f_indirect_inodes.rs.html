<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Source to the Rust file `solution/src/f_indirect_inodes.rs`."><meta name="keywords" content="rust, rustlang, rust-lang"><title>f_indirect_inodes.rs.html -- source</title><link rel="stylesheet" type="text/css" href="../../normalize.css"><link rel="stylesheet" type="text/css" href="../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../../light.css"  id="themeStyle"><link rel="stylesheet" type="text/css" href="../../dark.css" disabled ><link rel="stylesheet" type="text/css" href="../../ayu.css" disabled ><script src="../../storage.js"></script><noscript><link rel="stylesheet" href="../../noscript.css"></noscript><link rel="shortcut icon" href="../../favicon.ico"><style type="text/css">#crate-search{background-image:url("../../down-arrow.svg");}</style></head><body class="rustdoc source"><!--[if lte IE 8]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu">&#9776;</div><a href='../../cplfs_sol/index.html'><div class='logo-container rust-logo'><img src='../../rust-logo.png' alt='logo'></div></a></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!"><img src="../../brush.svg" width="18" alt="Pick another theme!"></button><div id="theme-choices"></div></div><script src="../../theme.js"></script><nav class="sub"><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" disabled autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><span class="help-button">?</span>
                <a id="settings-menu" href="../../settings.html"><img src="../../wheel.svg" width="18" alt="Change settings"></a></div></form></nav><section id="main" class="content"><pre class="line-numbers"><span id="1"> 1</span>
<span id="2"> 2</span>
<span id="3"> 3</span>
<span id="4"> 4</span>
<span id="5"> 5</span>
<span id="6"> 6</span>
<span id="7"> 7</span>
<span id="8"> 8</span>
<span id="9"> 9</span>
<span id="10">10</span>
<span id="11">11</span>
<span id="12">12</span>
<span id="13">13</span>
<span id="14">14</span>
<span id="15">15</span>
<span id="16">16</span>
<span id="17">17</span>
<span id="18">18</span>
<span id="19">19</span>
<span id="20">20</span>
<span id="21">21</span>
<span id="22">22</span>
<span id="23">23</span>
<span id="24">24</span>
<span id="25">25</span>
<span id="26">26</span>
<span id="27">27</span>
<span id="28">28</span>
<span id="29">29</span>
<span id="30">30</span>
<span id="31">31</span>
<span id="32">32</span>
<span id="33">33</span>
<span id="34">34</span>
<span id="35">35</span>
<span id="36">36</span>
<span id="37">37</span>
<span id="38">38</span>
<span id="39">39</span>
<span id="40">40</span>
<span id="41">41</span>
<span id="42">42</span>
<span id="43">43</span>
<span id="44">44</span>
<span id="45">45</span>
<span id="46">46</span>
<span id="47">47</span>
<span id="48">48</span>
<span id="49">49</span>
<span id="50">50</span>
<span id="51">51</span>
<span id="52">52</span>
<span id="53">53</span>
<span id="54">54</span>
<span id="55">55</span>
<span id="56">56</span>
<span id="57">57</span>
<span id="58">58</span>
<span id="59">59</span>
</pre><div class="example-wrap"><pre class="rust ">
<span class="doccomment">//! File system with support for inodes that have indirect blocks too.</span>
<span class="doccomment">//! Reimplementation of the inodes from the base project.</span>
<span class="doccomment">//! This additional assignment requires completion of assignment e, so go and do that one first if you haven&#39;t yet.</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! Create a filesystem that has a notion of inodes and blocks, by implementing the [`FileSysSupport`], the [`BlockSupport`], the [`InodeSupport`] and the [`InodeRWSupport`] traits together (again, all earlier traits are supertraits of the later ones).</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! [`FileSysSupport`]: ../../cplfs_api/fs/trait.FileSysSupport.html</span>
<span class="doccomment">//! [`BlockSupport`]: ../../cplfs_api/fs/trait.BlockSupport.html</span>
<span class="doccomment">//! [`InodeSupport`]: ../../cplfs_api/fs/trait.InodeSupport.html</span>
<span class="doccomment">//! [`InodeRWSupport`]: ../../cplfs_api/fs/trait.InodeRWSupport.html</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! However, this time, you **cannot** use the `DInode` type I provided, but rather, you have to define your own type,  have it derive all the traits you need (check the `#[derive(...)]` for `DInode` in the provided API code), wrap it in your own `Inode` type, and have your own `Inode` type implement the `InodeLike` trait, so that it is still compatible with the tests.</span>
<span class="doccomment">//! So far, we have only supported inodes that have at most a fixed, direct number of data blocks (i.e. `DIRECT_POINTERS` data blocks) associated to them.</span>
<span class="doccomment">//! Reimplement your solution for the base project, but now support inodes that have an extra field (let&#39;s call this field the *indirect block* field), that points to a single data block; the so-called *indirect block*.</span>
<span class="doccomment">//! As long as your inode requires `DIRECT_POINTERS` data blocks or fewer, all code behaves as before and the indirect block field is set to 0.</span>
<span class="doccomment">//! As soon as block number `DIRECT_POINTERS+1` has to be allocated, the indirect block gets allocated along with it, to store a sequence of block numbers.</span>
<span class="doccomment">//! The address of block `DIRECT_POINTERS+1` gets stored as the first address in the indirect block.</span>
<span class="doccomment">//! Later, when data block `DIRECT_POINTERS+2` has to be allocated, it gets stored in the second slot on the indirect block, and so on. In other words, given that inode numbers are of type `u64` and should in principle be represented by 8 bytes at runtime, this indirect block allows files to allocate another `block_size/8` blocks.</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! Some more specific pointers for the implementation:</span>
<span class="doccomment">//! - Try to come up with some helper functions that make it more convenient to work with indirect blocks</span>
<span class="doccomment">//! - Think of the scenario&#39;s where an indirect block might get (de)allocated. See if you can wrap this allocation in one of these previously mentioned helper functions.</span>
<span class="doccomment">//! - Since the `new` method in `InodeLike` is static and does not allow you to allocate new blocks, it should still not allow you to provide more than `DIRECT_POINTERS+1` blocks. The last block is then the block number of the indirect block. Similarly, the `get_block` method should simply return the number of the indirect block when queried for block *index* `DIRECT_POINTERS`, since there is no way for inodes to read from the device to figure out the actual block number.</span>
<span class="doccomment">//! - Do not forget to deallocate the indirect block itself, when truncating or freeing an inode.</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! It should be possible to swap out the inodes you use in your filesystem so far without making any of the tests for previous assignments fail.</span>
<span class="doccomment">//! You could do this (rather than copying all of your code and starting over) if you want some extra assurance that your implementation is still correct (or at least, still correct when not indexing inodes past the `DIRECT_POINTERS`th block)</span>
<span class="doccomment">//! At the end, write some tests that convincingly show that your implementation indeed supports indirect pointers.</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! Make sure this file does not contain any unaddressed `TODO`s anymore when you hand it in.</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! # Status</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! **TODO**: Replace the question mark below with YES, NO, or PARTIAL to</span>
<span class="doccomment">//! indicate the status of this assignment. If you want to tell something</span>
<span class="doccomment">//! about this assignment to the grader, e.g., you have a bug you can&#39;t fix,</span>
<span class="doccomment">//! or you want to explain your approach, write it down after the comments</span>
<span class="doccomment">//! section. If you had no major issues and everything works, there is no need to write any comments.</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! COMPLETED: ?</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! COMMENTS:</span>
<span class="doccomment">//!</span>
<span class="doccomment">//! ...</span>
<span class="doccomment">//!</span>

<span class="doccomment">/// You are free to choose the name for your file system. As we will use</span>
<span class="doccomment">/// automated tests when grading your assignment, indicate here the name of</span>
<span class="doccomment">/// your file system data type so we can just use `FSName` instead of</span>
<span class="doccomment">/// having to manually figure out the name.</span>
<span class="doccomment">/// **TODO**: replace the below type by the type of your file system</span>
<span class="kw">pub</span> <span class="kw">type</span> <span class="ident">FSName</span> <span class="op">=</span> ();

<span class="comment">// **TODO** define your own tests here.</span>

<span class="comment">// WARNING: DO NOT TOUCH THE BELOW CODE -- IT IS REQUIRED FOR TESTING -- YOU WILL LOSE POINTS IF I MANUALLY HAVE TO FIX YOUR TESTS</span>
<span class="attribute">#[<span class="ident">cfg</span>(<span class="ident">all</span>(<span class="ident">test</span>, <span class="ident">any</span>(<span class="ident">feature</span> <span class="op">=</span> <span class="string">&quot;f&quot;</span>, <span class="ident">feature</span> <span class="op">=</span> <span class="string">&quot;all&quot;</span>)))]</span>
<span class="attribute">#[<span class="ident">path</span> <span class="op">=</span> <span class="string">&quot;../../api/fs-tests/f_test.rs&quot;</span>]</span>
<span class="kw">mod</span> <span class="ident">tests</span>;
</pre></div>
</section><section id="search" class="content hidden"></section><section class="footer"></section><script>window.rootPath = "../../";window.currentCrate = "cplfs_sol";</script><script src="../../main.js"></script><script src="../../source-script.js"></script><script src="../../source-files.js"></script><script defer src="../../search-index.js"></script></body></html>